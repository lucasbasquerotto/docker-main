{% if params.volumes | default([]) | list | length > 0 %}volumes:
{% for item in params.volumes | list -%}
- path: "{{ params.data_dir + '/' + item.rel_path }}"
  {% if (item.mode | default('')) != '' 
  %}mode: "{{ item.mode }}"
  {% endif %}
{% endfor %}
{% endif %}

env_files: {{ params.env_files | default([]) | to_json }}

files:

- dir_base: "containers/fluentd/files"
  src: "Dockerfile"
  dest: "fluentd/Dockerfile"

- dir_base: "containers/elasticsearch/files"
  src: "Dockerfile"
  dest: "elasticsearch/Dockerfile"

- dir_base: "containers/kibana/files"
  src: "Dockerfile"
  dest: "kibana/Dockerfile"

templates:
  
- dir_base: "containers/fluentd/templates"
  src: "elasticsearch.conf"
  dest: "fluentd/fluent.conf"
  params:
    elasticsearch_port: "{{ params.fluentd.elasticsearch_port }}"
    flush_interval: "{{ params.fluentd.flush_interval }}"
    