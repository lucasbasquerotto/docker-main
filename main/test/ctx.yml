{% set var_local = params.main.local | default(false) | bool %}
{% set var_remote = params.main.local | default(false) | bool | ternary('false', 'true') %}
{% set var_compose_orchestration = params.pod.pod.orchestration in ['compose', 'none'] %}

env_files:
- src: "files/test/test.txt"
  dest: "test/pod/test.local.test3.txt"
  when: "{{ var_local }}"
- src: "files/test/test.txt"
  dest: "test/pod/test.local.test4.txt"
  when: "{{ var_local }}"
- src: "files/test/test.txt"
  dest: "files/test/pod/test.remote.test3.txt"
  when: "{{ var_remote }}"
- src: "files/test/test.txt"
  dest: "test/pod/test.remote.test4.txt"
  when: "{{ var_remote }}"

env_templates:
- src: "files/test/template.yml"
  dest: "test/pod/template.local.test3.yml"
  params: {{ params | to_json }}
  when: "{{ var_local }}"
- src: "files/test/template.yml"
  dest: "test/pod/template.local.test4.yml"
  params: {{ params | to_json }}
  when: "{{ var_local }}"
- src: "files/test/template.yml"
  dest: "test/pod/template.remote.test3.yml"
  params: {{ params | to_json }}
  when: "{{ var_remote }}"
- src: "files/test/template.yml"
  dest: "test/pod/template.remote.test4.yml"
  params: {{ params | to_json }}
  when: "{{ var_remote }}"

children:

{% if var_compose_orchestration %}

- name: "main/compose/vars.compose.yml"
  params: 
    env_params: {{ params | to_json }}
    env_params_list: []

{% else %}
  {% set error = {} %}
  {{ error['error.orchestration.invalid.' + params.pod.pod.orchestration] }}
{% endif %}

- name: "main/vars/vars.main.yml"
  params:
    env_params: {{ params | to_json }}
    volumes_dict: 
      test_pod_vol_2:
        rel_path: "test-path1"
        mode: "0777"
      test_pod_vol_1:
        rel_path: "test-path2"
        mode: "0777"
    services_data_dict: 
      test:
        param1: "value1"
        param2: 
          inner_param_1: "value1"
          inner_param_2: "value2"
